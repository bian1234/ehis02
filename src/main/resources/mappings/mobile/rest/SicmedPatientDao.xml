<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.cfq.mobile.rest.dao.SicmedPatientDao">

	<sql id="sicmedPatientColumns">
		a.id AS "id",
		a.patient_number AS "patientNumber",
		a.patient_name AS "patientName",
		a.patient_sex AS "patientSex",
		a.patient_age AS "patientAge",
		a.medicare_type AS "medicareType",
		a.medicare_no AS "medicareNo",
		a.patient_birthday AS "patientBirthday",
		a.patient_card AS "patientCard",
		a.patient_firstdate AS "patientFirstdate",
		a.patient_lastdate AS "patientLastdate",
		a.patient_address AS "patientAddress",
		a.patient_tel AS "patientTel",
		a.branch_code AS "sicmedBranch.id",
		a.doctor_code AS "sicmedDoctor.id",
		a.registered_code AS "sicmedRegistered.id",
		a.create_user AS "createUser.id",
		a.update_user AS "updateUser.id",
		a.delete_user AS "deleteUser.id",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag",

		u.user_name AS "sicmedDoctor.userName",<!-- 
		b.branch_name AS "sicmedBranch.branchName", -->
		e.branch_name AS "sicmedBranch.branchName"
	</sql>
	<sql id="sicmedPatientJoins">
		LEFT JOIN sicmed_user u ON u.id = a.doctor_code
		LEFT JOIN sicmed_branch b ON b.id = a.branch_code
		LEFT JOIN sicmed_registered r ON r.patient_code = a.id
		LEFT JOIN sicmed_branch e ON e.id = r.branch_code 
	</sql>
	<select id="get" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		WHERE a.id = #{id}
	</select>
	
	<!-- 模糊查询带分页web -->
	<!-- <select id="findLike" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number = #{patientNumber}
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name = #{patientName}
			</if>
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number LIKE CONCAT('%',#{patientNumber},'%' )
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name LIKE CONCAT('%',#{patientName},'%' )
			</if>
			<if test="patientSex != null and patientSex != ''">
				AND a.patient_sex = #{patientSex}
			</if>
			<if test="patientAge != null and patientAge != ''">
				AND a.patient_age = #{patientAge}
			</if>
			<if test="medicareType != null and medicareType != ''">
				AND a.medicare_type = #{medicareType}
			</if>
			<if test="medicareNo != null and medicareNo != ''">
				AND a.medicare_no = #{medicareNo}
			</if>
			<if test="patientBirthday != null and patientBirthday != ''">
				AND a.patient_birthday = #{patientBirthday}
			</if>
			<if test="patientCard != null and patientCard != ''">
				AND a.patient_card = #{patientCard}
			</if>
			<if test="patientFirstdate != null and patientFirstdate != ''">
				AND a.patient_firstdate = #{patientFirstdate}
			</if>
			<if test="patientLastdate != null and patientLastdate != ''">
				AND a.patient_lastdate = #{patientLastdate}
			</if>
			<if test="patientAddress != null and patientAddress != ''">
				AND a.patient_address = #{patientAddress}
			</if>
			<if test="patientTel != null and patientTel != ''">
				AND a.patient_tel = #{patientTel}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch!= '' ">
				AND a.branch_code = #{sicmedBranch.id}
			</if>
			<if
				test="sicmedDoctor != null and sicmedDoctor!= ''">
				AND a.doctor_code = #{sicmedDoctor.id}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch.id != '' and sicmedBranch.id != null">
				AND a.branch_code = #{sicmedBranch.id}
			</if>
			<if
				test="sicmedDoctor != null and sicmedDoctor.id != '' and sicmedDoctor.id != null">
				AND a.doctor_code = #{sicmedDoctor.id}
			</if>
			<if test="sicmedRegistered != null and sicmedRegistered != ''">
				AND a.registered_code = #{sicmedRegistered.id}
			</if>
			<if
				test="createUser != null and createUser.id != ''and createUser.id != null">
				AND a.create_user = #{createUser.id}
			</if>
			<if test="updateUser != null and updateUser != ''">
				AND a.update_user = #{updateUser.id}
			</if>
			<if test="searchContent != null and searchContent != ''">
				AND a.patient_number = #{searchContent} OR a.patient_name = #{searchContent}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select> -->

	<select id="getByEntity" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number = #{patientNumber}
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name = #{patientName}
			</if>
			<if test="patientSex != null and patientSex != ''">
				AND a.patient_sex = #{patientSex}
			</if>
			<if test="patientAge != null and patientAge != ''">
				AND a.patient_age = #{patientAge}
			</if>
			<if test="medicareType != null and medicareType != ''">
				AND a.medicare_type = #{medicareType}
			</if>
			<if test="medicareNo != null and medicareNo != ''">
				AND a.medicare_no = #{medicareNo}
			</if>
			<if test="patientBirthday != null and patientBirthday != ''">
				AND a.patient_birthday = #{patientBirthday}
			</if>
			<if test="patientCard != null and patientCard != ''">
				AND a.patient_card = #{patientCard}
			</if>
			<if test="patientFirstdate != null and patientFirstdate != ''">
				AND a.patient_firstdate = #{patientFirstdate}
			</if>
			<if test="patientLastdate != null and patientLastdate != ''">
				AND a.patient_lastdate = #{patientLastdate}
			</if>
			<if test="patientAddress != null and patientAddress != ''">
				AND a.patient_address = #{patientAddress}
			</if>
			<if test="patientTel != null and patientTel != ''">
				AND a.patient_tel = #{patientTel}
			</if>
			<if test="sicmedBranch != null and sicmedBranch != ''">
				AND a.branch_code = #{sicmedBranch.id}
			</if>
			<if test="sicmedDoctor != null and sicmedDoctor != ''">
				AND a.doctor_code = #{sicmedDoctor.id}
			</if>
			<if test="sicmedRegistered != null and sicmedRegistered != ''">
				AND a.registered_code = #{sicmedRegistered.id}
			</if>
			<if test="createUser != null and createUser != ''">
				AND a.create_user = #{createUser.id}
			</if>
			<if test="updateUser != null and updateUser != ''">
				AND a.update_user = #{updateUser.id}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findList" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<!-- <if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number = #{patientNumber}
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name = #{patientName}
			</if> -->
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number = #{patientNumber}
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name = #{patientName}
			</if>
			<if test="patientSex != null and patientSex != ''">
				AND a.patient_sex = #{patientSex}
			</if>
			<if test="patientAge != null and patientAge != ''">
				AND a.patient_age = #{patientAge}
			</if>
			<if test="medicareType != null and medicareType != ''">
				AND a.medicare_type = #{medicareType}
			</if>
			<if test="medicareNo != null and medicareNo != ''">
				AND a.medicare_no = #{medicareNo}
			</if>
			<if test="patientBirthday != null and patientBirthday != ''">
				AND a.patient_birthday = #{patientBirthday}
			</if>
			<if test="patientCard != null and patientCard != ''">
				AND a.patient_card = #{patientCard}
			</if>
			<if test="patientFirstdate != null and patientFirstdate != ''">
				AND a.patient_firstdate = #{patientFirstdate}
			</if>
			<if test="patientLastdate != null and patientLastdate != ''">
				AND a.patient_lastdate = #{patientLastdate}
			</if>
			<if test="patientAddress != null and patientAddress != ''">
				AND a.patient_address = #{patientAddress}
			</if>
			<if test="patientTel != null and patientTel != ''">
				AND a.patient_tel = #{patientTel}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch!= '' ">
				AND a.branch_code = #{sicmedBranch.id}
			</if>
			<if
				test="sicmedDoctor != null and sicmedDoctor!= ''">
				AND a.doctor_code = #{sicmedDoctor.id}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch.id != '' and sicmedBranch.id != null">
				AND a.branch_code = #{sicmedBranch.id}
			</if>
			<if
				test="sicmedDoctor != null and sicmedDoctor.id != '' and sicmedDoctor.id != null">
				AND a.doctor_code = #{sicmedDoctor.id}
			</if>
			<if test="sicmedRegistered != null and sicmedRegistered != ''">
				AND a.registered_code = #{sicmedRegistered.id}
			</if>
			<if
				test="createUser != null and createUser.id != ''and createUser.id != null">
				AND a.create_user = #{createUser.id}
			</if>
			<if test="updateUser != null and updateUser != ''">
				AND a.update_user = #{updateUser.id}
			</if>
			<if test="searchContent != null and searchContent != ''">
				AND a.patient_number = #{searchContent} OR a.patient_name = #{searchContent}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findAllList" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<!-- 模糊查询 sql -->

	<select id="findListLike" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number like CONCAT('%','${patientNumber}','%' )
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name like CONCAT('%','${patientName}','%' )
			</if>
			<if test="patientTel != null and patientTel != ''">
				AND a.patient_tel like CONCAT('%','${patientTel}','%' )
			</if>
			<if test="createUser != null and createUser != ''">
				AND a.create_user = #{createUser.id}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findLike" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number like CONCAT('%','${patientNumber}','%')
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name like CONCAT('%','${patientName}','%' )
			</if>
			<if test="id !=null and id !=''">
				AND a.id = #{id}
			</if>

		</where>
	</select>

	<insert id="insert">
		INSERT INTO sicmed_patient(
		id,
		patient_number,
		patient_name,
		patient_sex,
		patient_age,
		medicare_type,
		medicare_no,
		patient_birthday,
		patient_card,
		patient_firstdate,
		patient_lastdate,
		patient_address,
		patient_tel,
		branch_code,
		doctor_code,
		registered_code,
		create_user,
		update_user,
		delete_user,
		create_by,
		create_date,
		update_by,
		update_date,
		remarks,
		del_flag
		) VALUES (
		#{id},
		#{patientNumber},
		#{patientName},
		#{patientSex},
		#{patientAge},
		#{medicareType},
		#{medicareNo},
		#{patientBirthday},
		#{patientCard},
		#{patientFirstdate},
		#{patientLastdate},
		#{patientAddress},
		#{patientTel},
		#{sicmedBranch.id},
		#{sicmedDoctor.id},
		#{sicmedRegistered.id},
		#{createUser.id},
		#{updateUser.id},
		#{deleteUser.id},
		#{createBy.id},
		#{createDate},
		#{updateBy.id},
		#{updateDate},
		#{remarks},
		#{delFlag}
		)
	</insert>

	<update id="update">
		UPDATE sicmed_patient SET
		patient_number =
		#{patientNumber},
		patient_name = #{patientName},
		patient_sex =
		#{patientSex},
		patient_age = #{patientAge},
		medicare_type =
		#{medicareType},
		medicare_no = #{medicareNo},
		patient_birthday =
		#{patientBirthday},
		patient_card = #{patientCard},
		patient_firstdate =
		#{patientFirstdate},
		patient_lastdate = #{patientLastdate},
		patient_address = #{patientAddress},
		patient_tel = #{patientTel},
		branch_code = #{sicmedBranch.id},
		doctor_code = #{sicmedDoctor.id},
		registered_code = #{sicmedRegistered.id},
		create_user = #{createUser.id},
		update_user = #{updateUser.id},
		delete_user = #{deleteUser.id},
		update_by = #{updateBy.id},
		update_date = #{updateDate},
		remarks =
		#{remarks}
		WHERE id = #{id}
	</update>

	<update id="delete">
		UPDATE sicmed_patient SET
		del_flag =
		#{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	<!-- Max select -->
	<!-- 需要查询的字段 -->
	<sql id="sicmedPatientColumns2">
		a.id AS "id",
		a.patient_number AS "patientNumber",
		a.patient_name AS "patientName",
		a.patient_sex AS "patientSex",
		a.patient_age AS "patientAge",
		a.registered_code AS "sicmedRegistered.id",

	</sql>
	<!-- 需要连接的表 -->
		<sql id="sicmedPatientJoins2">
		LEFT JOIN sicmed_branch b ON b.id = a.branch_code
		LEFT JOIN sicmed_registered r ON r.id = a.registered_code
	</sql>
	<!-- 查询方法 -->
	
<select id="findListByDoctor" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedPatient">
		SELECT
		<include refid="sicmedPatientColumns" />
		FROM sicmed_patient a
		<include refid="sicmedPatientJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="patientNumber != null and patientNumber != ''">
				AND a.patient_number like CONCAT('%','${patientNumber}','%' )
			</if>
			<if test="patientName != null and patientName != ''">
				AND a.patient_name like CONCAT('%','${patientName}','%' )
			</if>
			<if test="patientTel != null and patientTel != ''">
				AND a.patient_tel like CONCAT('%','${patientTel}','%' )
			</if>
			<if test="createUser != null and createUser != ''">
				AND a.create_user = #{createUser.id}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
</mapper>