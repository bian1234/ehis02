<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.cfq.mobile.rest.dao.SicmedUserDao">

	<sql id="sicmedUserColumns">
		a.id AS "id",
		a.user_number AS "userNumber",
		a.user_name AS
		"userName",
		a.password AS "password",
		a.user_fodate AS "userFodate",
		a.user_todate
		AS "userTodate",
		a.user_job_group AS "userJobGroup",
		a.user_job_grade AS
		"userJobGrade",
		a.user_dept AS "sicmedDept.id",
		a.user_branch AS
		"sicmedBranch.id",
		a.doctor_code AS "doctorCode",
		a.doctor_grade AS
		"doctorGrade",
		a.printranking AS "printranking",
		a.doctor_registered_am
		AS "doctorRegisteredAm",
		a.doctor_registered_pm AS
		"doctorRegisteredPm",
		a.doctor_registered AS "doctorRegistered",
		a.registered_difference AS "registeredDifference",
		a.license AS
		"license",
		a.license_spc AS "licenseSpc",
		a.user_tel AS "userTel",
		a.user_email AS "userEmail",
		a.user_status AS "userStatus",
		a.change_fdate AS "changeFdate",
		a.change_odate AS "changeOdate",
		a.login_date AS "loginDate",
		a.doctor_branch1 AS "doctorBranch1",
		a.doctor_branch2 AS "doctorBranch2",
		a.doctor_branch3 AS
		"doctorBranch3",
		a.create_by AS "createBy.id",
		a.create_date AS
		"createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS
		"updateDate",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag",

		<!-- 部门信息 -->
		d.dept_number AS "sicmedDept.deptNumber",
		d.dept_name AS
		"sicmedDept.deptName",
		d.dept_pmpa AS "sicmedDept.deptPmpa",
		d.dept_code AS "sicmedDept.deptCode",
		d.create_by AS
		"sicmedDept.createBy.id",
		d.create_date AS "sicmedDept.createDate",
		d.update_by AS "sicmedDept.updateBy.id",
		d.update_date AS
		"sicmedDept.updateDate",
		d.remarks AS "sicmedDept.remarks",
		d.del_flag
		AS "sicmedDept.delFlag",
		
		<!-- 科室信息 -->
		c.branch_code AS "sicmedBranch.branchCode",
		c.branch_number AS
		"sicmedBranch.branchNumber",
		c.branch_name AS
		"sicmedBranch.branchName",
		c.branch_name_english AS
		"sicmedBranch.branchNameEnglish",
		c.branch_location AS
		"sicmedBranch.branchLocation",
		c.branch_registered AS
		"sicmedBranch.branchRegistered",
		c.branch_registered_am AS
		"sicmedBranch.branchRegisteredAm",
		c.branch_registered_pm AS
		"sicmedBranch.branchRegisteredPm",
		c.branch_ipd AS
		"sicmedBranch.branchIpd",
		c.create_by AS "sicmedBranch.createBy.id",
		c.create_date AS "sicmedBranch.createDate",
		c.update_by AS
		"sicmedBranch.updateBy.id",
		c.update_date AS "sicmedBranch.updateDate",
		c.remarks AS "sicmedBranch.remarks",
		c.del_flag AS
		"sicmedBranch.delFlag"

		<!-- f.invite_number AS "sicmedInviteNumber.inviteNumber", f.invite_status 
			AS "sicmedInviteNumber.inviteStatus" -->
	</sql>
	<sql id="sicmedUserJoins">
		LEFT JOIN sicmed_dept d ON d.id = a.user_dept
		LEFT JOIN sicmed_branch c ON c.id = a.user_branch
		<!-- RIGHT JOIN sicmed_invite_number f ON f.user_code = a.id -->
	</sql>

	<select id="getById" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		WHERE a.id = #{id}
	</select>

	<select id="get" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		WHERE a.id = #{id}
	</select>

	<!-- 用户登陆查询 -->
	<select id="login" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="userTel != null and userTel != ''">
				AND a.user_tel = #{userTel}
			</if>
			<if test="password != null and password != ''">
				AND a.password = #{password}
			</if>
		</where>
	</select>

	<!-- 根据电话号获取用户信息 -->
	<select id="getByTel" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		WHERE
		a.user_tel = #{userTel}
	</select>
	<!-- 根据部门获取用户信息 -->
	<select id="findByBranch" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			AND a.user_branch =
			#{sicmedBranch.id}
		</where>
	</select>
	
	<!-- 根据患者挂号类型和科室获取 医生信息 -->
	<select id="findDoctorByTypeAndBranch" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="userJobGrade != null and userJobGrade != ''">
			 AND a.user_job_grade &gt;= #{userJobGrade} 
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch.id != '' and sicmedBranch.id !=null ">
				AND a.user_branch = #{sicmedBranch.id}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<!-- 模糊搜索带分页web -->
	<select id="findLike" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="userNumber != null and userNumber != ''">
				AND a.user_number LIKE CONCAT('%',#{userNumber},'%' )
			</if>
			<if test="userName != null and userName != ''">
				AND a.user_name LIKE CONCAT('%',#{userName},'%' )
			</if>
			<!-- <if test="password != null and password != ''"> AND a.password = 
				#{password} </if> -->
			<if test="userFodate != null and userFodate != ''">
				AND a.user_fodate = #{userFodate}
			</if>
			<if test="userTodate != null and userTodate != ''">
				AND a.user_todate = #{userTodate}
			</if>
			<if test="userJobGroup != null and userJobGroup != ''">
				AND a.user_job_group LIKE CONCAT('%',#{userJobGroup},'%' )
			</if>
			<!-- <if test="userJobGrade != null and userJobGrade != ''"> AND a.user_job_grade 
				= #{userJobGrade} </if> -->
			<if test="sicmedDept != null and sicmedDept.id != '' and sicmedDept.id != null">
				AND a.user_dept = #{sicmedDept.id}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch.id != '' and sicmedBranch.id !=null ">
				AND a.user_branch = #{sicmedBranch.id} 
			</if>
			<!-- <if
				test="sicmedBranch != null and sicmedBranch.branchName != '' and sicmedBranch.branchName !=null ">
				AND c.branch_name = #{sicmedBranch.branchName}
			</if> -->
			<if
				test="sicmedBranch != null and sicmedBranch.branchName != '' and sicmedBranch.branchName !=null ">
				AND c.branch_name LIKE CONCAT('%',#{sicmedBranch.branchName},'%' )
			</if>
			<if test="doctorCode != null and doctorCode != ''">
				AND a.doctor_code = #{doctorCode}
			</if>
			<if test="doctorGrade != null and doctorGrade != ''">
				AND a.doctor_grade = #{doctorGrade}
			</if>
			<!-- <if test="printranking != null and printranking != ''"> AND a.printranking 
				= #{printranking} </if> -->
			<if test="doctorRegisteredAm != null and doctorRegisteredAm != ''">
				AND a.doctor_registered_am = #{doctorRegisteredAm}
			</if>
			<if test="doctorRegisteredPm != null and doctorRegisteredPm != ''">
				AND a.doctor_registered_pm = #{doctorRegisteredPm}
			</if>
			<if test="doctorRegistered != null and doctorRegistered != ''">
				AND a.doctor_registered = #{doctorRegistered}
			</if>
			<if test="registeredDifference != null and registeredDifference != ''">
				AND a.registered_difference = #{registeredDifference}
			</if>
			<if test="license != null and license != ''">
				AND a.license = #{license}
			</if>
			<if test="licenseSpc != null and licenseSpc != ''">
				AND a.license_spc = #{licenseSpc}
			</if>
			<if test="userTel != null and userTel != ''">
				AND a.user_tel LIKE CONCAT('%',#{userTel},'%' )
			</if>
			<if test="userEmail != null and userEmail != ''">
				AND a.user_email = #{userEmail}
			</if>
			<if test="userStatus != null and userStatus != ''">
				AND a.user_status = #{userStatus}
			</if>
			<if test="changeFdate != null and changeFdate != ''">
				AND a.change_fdate = #{changeFdate}
			</if>
			<if test="changeOdate != null and changeOdate != ''">
				AND a.change_odate = #{changeOdate}
			</if>
			<if test="doctorBranch1 != null and doctorBranch1 != ''">
				AND a.doctor_branch1 = #{doctorBranch1}
			</if>
			<if test="doctorBranch2 != null and doctorBranch2 != ''">
				AND a.doctor_branch2 = #{doctorBranch2}
			</if>
			<if test="doctorBranch3 != null and doctorBranch3 != ''">
				AND a.doctor_branch3 = #{doctorBranch3}
			</if>
			<if test="loginDate != null and loginDate != ''">
				AND a.login_date = #{loginDate}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findList" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
				AND a.id = #{id}
			</if>
			<if test="userNumber != null and userNumber != ''">
				AND a.user_number = #{userNumber}
			</if>
			<if test="userName != null and userName != ''">
				AND a.user_name = #{userName}
			</if>
			<!-- <if test="password != null and password != ''"> AND a.password = 
				#{password} </if> -->
			<if test="userFodate != null and userFodate != ''">
				AND a.user_fodate = #{userFodate}
			</if>
			<if test="userTodate != null and userTodate != ''">
				AND a.user_todate = #{userTodate}
			</if>
			<if test="userJobGroup != null and userJobGroup != ''">
				AND a.user_job_group = #{userJobGroup}
			</if>
			<!-- <if test="userJobGrade != null and userJobGrade != ''"> AND a.user_job_grade 
				= #{userJobGrade} </if> -->
			<if test="sicmedDept != null and sicmedDept.id != '' and sicmedDept.id != null">
				AND a.user_dept = #{sicmedDept.id}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch.id != '' and sicmedBranch.id !=null ">
				AND a.user_branch = #{sicmedBranch.id} 
			</if>
			<!-- <if
				test="sicmedBranch != null and sicmedBranch.branchName != '' and sicmedBranch.branchName !=null ">
				AND c.branch_name = #{sicmedBranch.branchName}
			</if> -->
			<if
				test="sicmedBranch != null and sicmedBranch.branchName != '' and sicmedBranch.branchName !=null ">
				AND c.branch_name = #{sicmedBranch.branchName}
			</if>
			<if test="doctorCode != null and doctorCode != ''">
				AND a.doctor_code = #{doctorCode}
			</if>
			<if test="doctorGrade != null and doctorGrade != ''">
				AND a.doctor_grade = #{doctorGrade}
			</if>
			<!-- <if test="printranking != null and printranking != ''"> AND a.printranking 
				= #{printranking} </if> -->
			<if test="doctorRegisteredAm != null and doctorRegisteredAm != ''">
				AND a.doctor_registered_am = #{doctorRegisteredAm}
			</if>
			<if test="doctorRegisteredPm != null and doctorRegisteredPm != ''">
				AND a.doctor_registered_pm = #{doctorRegisteredPm}
			</if>
			<if test="doctorRegistered != null and doctorRegistered != ''">
				AND a.doctor_registered = #{doctorRegistered}
			</if>
			<if test="registeredDifference != null and registeredDifference != ''">
				AND a.registered_difference = #{registeredDifference}
			</if>
			<if test="license != null and license != ''">
				AND a.license = #{license}
			</if>
			<if test="licenseSpc != null and licenseSpc != ''">
				AND a.license_spc = #{licenseSpc}
			</if>
			<if test="userTel != null and userTel != ''">
				AND a.user_tel = #{userTel}
			</if>
			<if test="userEmail != null and userEmail != ''">
				AND a.user_email = #{userEmail}
			</if>
			<if test="userStatus != null and userStatus != ''">
				AND a.user_status = #{userStatus}
			</if>
			<if test="changeFdate != null and changeFdate != ''">
				AND a.change_fdate = #{changeFdate}
			</if>
			<if test="changeOdate != null and changeOdate != ''">
				AND a.change_odate = #{changeOdate}
			</if>
			<if test="doctorBranch1 != null and doctorBranch1 != ''">
				AND a.doctor_branch1 = #{doctorBranch1}
			</if>
			<if test="doctorBranch2 != null and doctorBranch2 != ''">
				AND a.doctor_branch2 = #{doctorBranch2}
			</if>
			<if test="doctorBranch3 != null and doctorBranch3 != ''">
				AND a.doctor_branch3 = #{doctorBranch3}
			</if>
			<if test="loginDate != null and loginDate != ''">
				AND a.login_date = #{loginDate}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findList1" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="doctorGrade != null and doctorGrade != ''">
				AND a.doctor_grade &gt;= #{doctorGrade}
			</if>
			<if
				test="sicmedBranch != null and sicmedBranch.id != '' and sicmedBranch.id !=null ">
				AND a.user_branch = #{sicmedBranch.id}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<select id="findAllList" resultType="com.thinkgem.jeesite.cfq.mobile.rest.entity.SicmedUser">
		SELECT
		<include refid="sicmedUserColumns" />
		FROM sicmed_user a
		<include refid="sicmedUserJoins" />
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>

	<insert id="insert">
		INSERT INTO sicmed_user(
		id,
		user_number,
		user_name,
		password,
		user_fodate,
		user_todate,
		user_job_group,
		user_job_grade,
		user_dept,
		user_branch,
		doctor_code,
		doctor_grade,
		printranking,
		doctor_registered_am,
		doctor_registered_pm,
		doctor_registered,
		registered_difference,
		license,
		license_spc,
		login_date,
		user_tel,
		user_email,
		user_status,
		change_fdate,
		change_odate,
		doctor_branch1,
		doctor_branch2,
		doctor_branch3,
		create_by,
		create_date,
		update_by,
		update_date,
		remarks,
		del_flag
		) VALUES (
		#{id},
		#{userNumber},
		#{userName},
		#{password},
		#{userFodate},
		#{userTodate},
		#{userJobGroup},
		#{userJobGrade},
		#{sicmedDept.id},
		#{sicmedBranch.id},
		#{doctorCode},
		#{doctorGrade},
		#{printranking},
		#{doctorRegisteredAm},
		#{doctorRegisteredPm},
		#{doctorRegistered},
		#{registeredDifference},
		#{license},
		#{licenseSpc},
		#{loginDate},
		#{userTel},
		#{userEmail},
		#{userStatus},
		#{changeFdate},
		#{changeOdate},
		#{doctorBranch1},
		#{doctorBranch2},
		#{doctorBranch3},
		#{createBy.id},
		#{createDate},
		#{updateBy.id},
		#{updateDate},
		#{remarks},
		#{delFlag}
		)
	</insert>

	<update id="update">
		UPDATE sicmed_user SET
		user_number = #{userNumber},
		user_name = #{userName},
		password = #{password},
		user_fodate =
		#{userFodate},
		user_todate = #{userTodate},
		user_job_group =
		#{userJobGroup},
		user_job_grade = #{userJobGrade},
		user_dept =
		#{sicmedDept.id},
		user_branch = #{sicmedBranch.id},
		doctor_code =
		#{doctorCode},
		doctor_grade = #{doctorGrade},
		printranking =
		#{printranking},
		doctor_registered_am = #{doctorRegisteredAm},
		doctor_registered_pm = #{doctorRegisteredPm},
		doctor_registered =
		#{doctorRegistered},
		registered_difference = #{registeredDifference},
		license = #{license},
		license_spc = #{licenseSpc},
		login_date =
		#{loginDate},
		user_tel =
		#{userTel},
		user_email = #{userEmail},
		user_status = #{userStatus},
		change_fdate = #{changeFdate},
		change_odate = #{changeOdate},
		doctor_branch1 = #{doctorBranch1},
		doctor_branch2 = #{doctorBranch2},
		doctor_branch3 = #{doctorBranch3},
		update_by = #{updateBy.id},
		update_date = #{updateDate},
		remarks =
		#{remarks}
		WHERE id = #{id}
	</update>

	<update id="delete">
		UPDATE sicmed_user SET
		del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>

</mapper>